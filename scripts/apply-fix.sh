#!/system/bin/sh
#
# apply-fix.sh — Installs stub com.android.vending so HomeLogic works.
#
# Uses pm install (writes to /data/app) — no /system remount needed.
# Safe to run on every boot. Skips if already installed.
#

set -e

TMP_APK="/data/local/tmp/_vending_stub.apk"

echo ""
echo "============================================"
echo "  HomeLogic Play Store Fix"
echo "============================================"
echo ""

# ── Check if already installed ──────────────────────────────────
if pm list packages 2>/dev/null | grep -q "com.android.vending"; then
    echo "[OK] com.android.vending already installed. Nothing to do."
    exit 0
fi

# ── Decode stub APK ─────────────────────────────────────────────
echo "[INFO] Decoding stub APK..."

base64 -d << 'APKEOF' > "$TMP_APK"
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AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA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AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4DwAAAAAAAEFQSyBTaWcgQmxvY2sgNDJQSwECAAAAAAAACAAAACEAGCueSwECAAAABQAAEwAAAAAAAAAAAAAAAAAAAAAAQW5kcm9pZE1hbmlmZXN0LnhtbFBLAQIAAAAAAAAAAAAAIQALUDYTKAAAACgAAAAOAAAAAAAAAAAAAAAAADICAAByZXNvdXJjZXMuYXJzY1BLAQIUABQAAAgIAAAAIQBQSdbT/AAAAEkBAAAQAAAAAAAAAAAAAAAAAIwCAABNRVRBLUlORi9TVFVCLlNGUEsBAhQAFAAACAgAAAAhAHFpeN0gBAAAKAUAABEAAAAAAAAAAAAAAAAAtgMAAE1FVEEtSU5GL1NUVUIuUlNBUEsBAhQAFAAACAgAAAAhAP2B0BaoAAAAygAAABQAAAAAAAAAAAAAAAAABQgAAE1FVEEtSU5GL01BTklGRVNULk1GUEsFBgAAAAAFAAUAPAEAAAAgAAAAAA==
APKEOF

if [ ! -f "$TMP_APK" ]; then
    echo "[ERROR] Failed to decode APK."
    exit 1
fi

# ── Install via pm install (writes to /data/app, no /system needed) ─
echo "[INFO] Installing stub APK via pm install..."
INSTALL_OUTPUT=$(pm install -r "$TMP_APK" 2>&1)
INSTALL_EXIT=$?

rm -f "$TMP_APK"

if [ $INSTALL_EXIT -eq 0 ] && echo "$INSTALL_OUTPUT" | grep -q "Success"; then
    echo "[OK] com.android.vending stub installed successfully."
else
    echo "[ERROR] pm install failed (exit=$INSTALL_EXIT): $INSTALL_OUTPUT"
    exit 1
fi

echo ""
echo "[OK] HomeLogic Play Store fix applied."
echo ""
